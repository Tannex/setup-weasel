---
- name: "install software-properties-common"
  apt:
    update_cache: true
    name: software-properties-common
    state: latest
- name: "setup neovim repo"
  apt_repository:
    repo: ppa:neovim-ppa/stable
    state: present
- name: "install packages"
  apt:
    update_cache: true
    pkg:
    - btop
    - tmux
    - zsh
    - neovim
    - git
    - lsd
    state: latest
- name: "get non-root user name"
  become: false
  set_fact:
    current_user: "{{ ansible_user_id }}"
    user_home: "{{ lookup('env','HOME') }}"
- name: "chsh"
  become: true
  user:
    name: "{{ current_user }}"
    shell: /usr/bin/zsh
- name: "check oh-my-zsh install state"
  become: false
  stat:
    path: "{{ user_home }}/.oh-my-zsh"
  register: omz_stat
- name: "install oh-my-zsh"
  become: false
  when: not omz_stat.stat.exists
  shell: 'sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"'
- name: "check p10k state"
  become: false
  stat:
    path: "{{ user_home }}/.oh-my-zsh/custom/themes/powerlevel10k"
  register: p10k_stat
- name: "install powerlevel10k"
  when: not p10k_stat.stat.exists
  become: false
  shell: 'git clone --depth=1 https://github.com/romkatv/powerlevel10k.git "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k"'